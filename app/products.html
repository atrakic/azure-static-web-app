<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-4">Products</h1>
        <div class="mb-3">
            <form id="addProductForm" class="row g-2">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="productName" placeholder="Product Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control" id="productPrice" placeholder="Price" required min="0" step="0.01">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Add Product</button>
                </div>
            </form>
        </div>
        <table class="table table-striped" id="productsTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th style="width: 120px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Products will be rendered here -->
            </tbody>
        </table>
    </div>

    <script>
        const apiUrl = '/api/products';

        // Fetch and render products
        async function loadProducts() {
            const res = await fetch(apiUrl);
            const products = await res.json();
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';
            products.forEach(product => {
                tbody.innerHTML += `
                    <tr data-id="${product.id}">
                        <td><input type="text" class="form-control form-control-sm name-edit" value="${product.name}" /></td>
                        <td><input type="number" class="form-control form-control-sm price-edit" value="${product.price}" min="0" step="0.01" /></td>
                        <td>
                            <button class="btn btn-success btn-sm save-btn">Save</button>
                            <button class="btn btn-danger btn-sm delete-btn">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Add product
        document.getElementById('addProductForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            if (!name || isNaN(price)) return;
            await fetch(apiUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, price })
            });
            this.reset();
            loadProducts();
        });

        // Save or delete product
        document.querySelector('#productsTable tbody').addEventListener('click', async function(e) {
            const tr = e.target.closest('tr');
            const id = tr.getAttribute('data-id');
            if (e.target.classList.contains('save-btn')) {
                const name = tr.querySelector('.name-edit').value.trim();
                const price = parseFloat(tr.querySelector('.price-edit').value);
                await fetch(`${apiUrl}/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name, price })
                });
                loadProducts();
            }
            if (e.target.classList.contains('delete-btn')) {
                await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
                loadProducts();
            }
        });

        // Initial load
        loadProducts();
    </script>
</body>
</html>